{"data":[{"slug":"cluster/ghcr-ci","title":"GHCRでラズパイクラスタのCI","author":"山D","date":"2022-03-11T00:00:00.000Z","dateUpd":"2022-03-11T00:00:00.000Z","body":"<h1 id=\"ghcrでラズパイクラスタのci\">GHCRでラズパイクラスタのCI</h1>\n<ul>\n<li>self-hosted runnerを用意してpush時にクラスタにデプロイ</li>\n<li>クラスタでは，GHCRにあるprivateのnodeのイメージを使ってDeploymentを構成し，Serviceで公開する．</li>\n<li>同じクラスタに別のDeploymentを用意して，cloudflaredを動かしてServiceを公開(tunnel)</li>\n</ul>\n","authors":["山D"]},{"slug":"computer/cpu/index","title":"CPU開発","description":"計算機制作::CPU","body":"<h1 id=\"cpu開発\">CPU開発</h1>\n<p><img src=\"/assets/img/cpu.jpg\" alt=\"CPU\"></p>\n<p>高専生なら1度は必ず挑戦すると言われている自作CPUを部活で制作しています。</p>\n<h2 id=\"ハリボテック\">ハリボテック</h2>\n<p>まだ完成していません。</p>\n","authors":[]},{"slug":"cluster/k0s","title":"ラズパイでk0sクラスタ構築","author":"山D","date":"2022-03-08T00:00:00.000Z","dateUpd":"2022-07-29T00:00:00.000Z","body":"<h1 id=\"ラズパイでk0sクラスタ構築\">ラズパイでk0sクラスタ構築</h1>\n<p>やったのでメモ．</p>\n<h2 id=\"ラズパイのセットアップ\">ラズパイのセットアップ</h2>\n<p>自動化って何</p>\n<p>まず，SDカードを用意し，<a href=\"https://raspi.debian.net/tested-images/\">raspi.debian.net</a>から適切なイメージのxzアーカイブをダウンロードする．\nここでは11(bullseye)を使用する．</p>\n<h3 id=\"1-イメージをsdカードdevsdxに焼く・dagmathrmrootfsdagのマウント\">1. イメージをSDカード(/dev/sd$x$)に焼く・$\\dag\\mathrm{rootfs}\\dag$のマウント</h3>\n<pre><code># dd if=20220121_raspi_2_bullseye.img of=/dev/sdx status=progress\n# mount /dev/sdx2 /mnt\n</code></pre>\n<h3 id=\"2-ネットワークの設定\">2. ネットワークの設定</h3>\n<p>注意して適宜読み替えること．</p>\n<p>まず，IPを固定する．</p>\n<p><code>/mnt/etc/network/interfadces.d/eth0</code>の<code>inet</code>を<code>auto</code>から<code>static</code>に変更する :</p>\n<pre><code>auto eth0\niface eth0 inet static\n  address 192.168.hoge.fuga/24\n  gateway 192.168.hoge.1\niface eth0 inet6 auto\n</code></pre>\n<p>無線接続を考えているのであれば<code>wpa_supplicant.conf</code>を用意すればよさげ．</p>\n<p>次に，resolv.confを置く．\nraspbianとかを使ってるなら必要無いかも．</p>\n<p><code>/mnt/etc/resolv.conf</code>を次のようにする :</p>\n<pre><code>nameserver 192.168.hoge.1\nnameserver 1.1.1.1\n</code></pre>\n<p>最後に，hostnameを設定する．\nこれはシェルで操作する時にわかりやすくするため．</p>\n<p><code>/mnt/etc/hostname</code>を編集する．</p>\n<h3 id=\"3-sshの設定\">3. sshの設定</h3>\n<p>今回はrootでもsshが使えるように設定していく．</p>\n<p>まず，<code>/mnt/etc/ssh/sshd_config</code>を編集する :</p>\n<pre><code class=\"language-diff\">--- /mnt/etc/ssh/sshd_config\n+++ new\n@@ -15 +15 @@\n-#Port 22\n+Port 22\n@@ -34 +34 @@\n-#PermitRootLogin prohibit-password\n+PermitRootLogin prohibit-password\n</code></pre>\n<p>次に，公開鍵を登録する．\n鍵の作成方法については各自ggること．</p>\n<pre><code># mkdir -p /mnt/root/.ssh\n# echo &quot;ssh-xxxx xxxxxxxxxxxxxxxx&quot; &gt;&gt; /mnt/root/.ssh/authorized_keys\n</code></pre>\n<h3 id=\"4-sshdを有効化する\">4. sshdを有効化する</h3>\n<p>最初に$\\dag\\mathrm{rootfs}\\dag$をアンマウントしている．</p>\n<pre><code># umount /mnt\n# mount /dev/sdx1 /mnt\n# touch /mnt/ssh\n# umount /mnt\n</code></pre>\n<p>これで，もうこのSDカードにしがらみは存在しない．\nPCからぶっこ抜く．</p>\n<h3 id=\"5-その他設定\">5. その他設定</h3>\n<ul>\n<li>tmpfsとかをいい感じに設定する</li>\n</ul>\n<h3 id=\"6-起動・接続\">6. 起動・接続</h3>\n<p>ラズパイのローカルIPを固定しsshdを有効化したので，(とくにトラブらない限り)完全にヘッドレス運用が可能．\nということでSDカードとLANケーブルを刺して電源を投入．</p>\n<p>しばらく待ってpingが通るようであれば，sshで接続する．</p>\n<pre><code>% ssh -i /path/to/priv_key -p 22 root@192.168.hoge.fuga\n</code></pre>\n<h2 id=\"クラスタの構築k0sctl\">クラスタの構築(k0sctl)</h2>\n<p>これを使うと楽らしい．(実際楽だった)</p>\n<p>まだ完全な理解に至っていないのでいろいろ不正確かも．</p>\n<h3 id=\"1-作業用pcにk0sctlを入れる\">1. 作業用PCにk0sctlを入れる</h3>\n<p>実際にやるときはgithub(<a href=\"https://github.com/k0sproject/k0sctl#installation\">k0sproject/k0sctl</a>)を参照のこと．</p>\n<p>現状，goが動く環境で</p>\n<pre><code>% go install github.com/k0sproject/k0sctl@latest\n</code></pre>\n<p>とするとよい(らしい)．</p>\n<h3 id=\"2-設定する\">2. 設定する</h3>\n<p>ここからはラズパイ(マスターノードを含む)ではなく，作業用の環境で実行する．</p>\n<p>実際にやるときは<a href=\"https://docs.k0sproject.io/v1.23.3+k0s.1/k0sctl-install/\">docs.k0sproject.io</a>を参照．</p>\n<pre><code>% k0sctl init &gt; k0sctl.yaml\n</code></pre>\n<p>でk0sctlの設定の雛形が吐かれるので，これを編集する．\nこのファイルはk0sのノード毎の設定とは別物なので注意．</p>\n<p>できたら実機にデプロイする．</p>\n<pre><code>% k0sctl apply --config k0sctl.yaml\n</code></pre>\n<p>しばらく(プロンプトが帰ってくるまで)待つ．</p>\n<p>終わったらkubeconfigを吐かせる．\nこれによって<code>kubectl</code>が使えたりする．</p>\n<pre><code>% k0sctl kubeconfig &gt; kubeconfig\n</code></pre>\n<h2 id=\"蛇足\">蛇足</h2>\n<p>ノードを作り直すときは</p>\n<ul>\n<li><code>/etc/k0s</code></li>\n<li><code>/var/lib/k0s</code></li>\n<li><code>/etc/systemd/system/k0s*</code></li>\n</ul>\n<p>を消すといいかも．</p>\n<p>ノードを全てラズパイで構築した場合，k0sctl applyでそこそこ時間がかかった．</p>\n","authors":["山D"]},{"slug":"cluster/index","title":"ラズパイクラスタ","body":"<h1 id=\"ラズパイクラスタ\">ラズパイクラスタ</h1>\n<p><img src=\"/assets/img/raspi.png\" alt=\"ラズパイクラスタ\"></p>\n<h2 id=\"構築\">構築</h2>\n<ul>\n<li><a href=\"k0s/\">ラズパイでk0sクラスタ構築</a></li>\n<li><a href=\"ghcr-ci/\">GHCRでラズパイクラスタのCI</a></li>\n</ul>\n<h2 id=\"運用\">運用</h2>\n","authors":[]},{"slug":"computer/index","title":"計算機制作","description":"真の意味での自作コンピュータを目指します","body":"<h1 id=\"自作コンピュータ\">自作コンピュータ</h1>\n<h2 id=\"上の方のレイヤ\">上の方のレイヤ</h2>\n<ul>\n<li><a href=\"os/\">OS</a></li>\n</ul>\n<h2 id=\"下の方のレイヤ\">下の方のレイヤ</h2>\n<ul>\n<li><a href=\"cpu/\">CPU</a></li>\n</ul>\n","authors":[]},{"slug":"computer/os/index","title":"OS開発","description":"計算機制作::OS","body":"<h1 id=\"os開発\">OS開発</h1>\n<p>高専生なら1度は必ず挑戦すると言われている自作OSを部活で制作しています。</p>\n<h2 id=\"ハリボテック\">ハリボテック</h2>\n<p>まだ完成していません。</p>\n","authors":[]},{"slug":"denkou/index","title":"電子工作","description":"電子工作をします","body":"<h1 id=\"電子工作\">電子工作</h1>\n<p>電算部の電子工作活動についての記録です</p>\n<h2 id=\"固定記事シリーズ\">固定記事(シリーズ)</h2>\n<ul>\n<li><a href=\"ne555synth/\">NE555でシンセをつくるらしい</a></li>\n</ul>\n<h2 id=\"新着記事\">新着記事</h2>\n<p>- </p>\n","authors":[]},{"slug":"denkou/ne555synth/index","title":"NE555でシンセをつくりたい","description":"NE555であそびま","body":"<h1 id=\"ne555でシンセをつくるらしい\">NE555でシンセをつくるらしい</h1>\n<h2 id=\"シンセって、なんだろう。\">シンセって、なんだろう。</h2>\n<ul>\n<li><a href=\"\">シンセとは</a></li>\n<li><a href=\"\">各部位のご案内</a></li>\n</ul>\n<h2 id=\"基礎を、作らせていただきます。\">基礎を、作らせていただきます。</h2>\n<ul>\n<li><a href=\"\">NE555って何</a></li>\n</ul>\n","authors":[]},{"slug":"index","title":"Dev","description":"開発開発開発開発","body":"<h1 id=\"開発\">開発</h1>\n<p>開発やってます．</p>\n<h2 id=\"低レイヤ\">低レイヤ</h2>\n<p>真の意味での自作コンピュータを目指します．</p>\n<ul>\n<li><a href=\"computer/\">計算機制作</a> : OS，CPUなど</li>\n</ul>\n<h2 id=\"ラズパイクラスタ\">ラズパイクラスタ</h2>\n<p>余らせているラズパイを有効活用しています．</p>\n<ul>\n<li><a href=\"cluster/\">ラズパイクラスタ</a></li>\n</ul>\n<h2 id=\"web関連\">Web関連</h2>\n<p>React，Vue，Svelteなどモダンなフレームワークを使用して遊んでいます．</p>\n<ul>\n<li><a href=\"https://github.com/KCCTdensan/d3bu.net\">d3bu.net</a> : このWebサイト</li>\n</ul>\n<h2 id=\"電子工作\">電子工作</h2>\n<p>パソコン部といえど電子工作くらいはします．</p>\n<ul>\n<li><a href=\"denkou/\">電子工作</a> : ちょっとしたIoTなど</li>\n<li><a href=\"https://denko.d3bu.net\">電工部</a> : 電子工作に特化した部活</li>\n</ul>\n<h2 id=\"その他\">その他</h2>\n<ul>\n<li><a href=\"/tools/py/\">Python REPL</a></li>\n</ul>\n","authors":[]}]}